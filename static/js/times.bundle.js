!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){"use strict";r.d(e,"a",function(){return i}),r.d(e,"b",function(){return a}),r.d(e,"c",function(){return o}),r.d(e,"e",function(){return h}),r.d(e,"f",function(){return d}),r.d(e,"d",function(){return l}),r.d(e,"g",function(){return s}),r.d(e,"h",function(){return c}),r.d(e,"i",function(){return u});var n=r(2);const i=(t,e)=>r=>Math.max(t,Math.min(r,e)),a=i(0,255),o=(i(0,65535),t=>180*t/Math.PI),u=t=>t*Math.PI/180,s=()=>{return void 0!==n.a.cache.littleEndian?n.a.cache.littleEndian:(()=>{let t=new ArrayBuffer(4),e=new Uint8ClampedArray(t);return new Uint32Array(t)[0]=168496141,n.a.cache.littleEndian=13===e[0],n.a.cache.littleEndian})()},c=(...t)=>(e,r=!1)=>{let n=T.Raster.from(e,!0);return t.reduce((t,e,n)=>e(t,r),n)},l=(t,e,r)=>t+e*r,h=(t,e)=>t%e,d=(t,e)=>Math.floor(t/e)},function(t,e,r){"use strict";r.d(e,"a",function(){return u}),r.d(e,"d",function(){return o}),r.d(e,"b",function(){return n}),r.d(e,"c",function(){return i}),r.d(e,"e",function(){return a});const n=(t,e,r,n,i)=>e>=0&&e<n&&r>=0&&r<i?t[e+r*n]:0,i=(t,e,r,n,i)=>{return t[Math.min(Math.max(e,0),n-1)+Math.min(Math.max(r,0),i-1)*n]},a=(t,e,r,n,i)=>{return t[(n+e)%n+(i+r)%i*n]},o=(t,e,r,n,i,a)=>i.reduce((i,o)=>i+=a(e,cpu.getX(t,r)+o.offsetX,cpu.getY(t,r)+o.offsetY,r,n)*o.weight,0),u=(t,e,r,n,i,a)=>t.map((t,o,u)=>a(o,u,e,r,n,i))},function(t,e,r){"use strict";r.d(e,"a",function(){return n});const n={storage:[],cache:{},initStorage:()=>n.storage=[]}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(4),i=r(11),a=r(12),o=r(27);r.d(e,"T",function(){return n}),r.d(e,"io",function(){return i}),r.d(e,"cpu",function(){return a}),r.d(e,"gpu",function(){return o})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});r(2);var n=r(5),i=r(6),a=r(7),o=r(8),u=r(9),s=r(10);r.d(e,"Raster",function(){return n.a}),r.d(e,"Image",function(){return i.a}),r.d(e,"Stack",function(){return a.a}),r.d(e,"Volume",function(){return o.a}),r.d(e,"Window",function(){return u.a}),r.d(e,"View",function(){return s.a})},function(t,e,r){"use strict";e.a=class{constructor(t,e,r,n=1){this.width=e,this.height=r,this.depth=n,this.label="None",this.length=this.width*this.height*this.depth,this.type=t,this.pixelData,this.parent}static createPixels(t,e){let r;switch(t){case"uint8":r=new Uint8ClampedArray(e).fill(0);break;case"uint16":r=new Uint16Array(e).fill(0);break;case"uint32":r=new Uint32Array(e).fill(0);break;case"float32":r=new Float32Array(e).fill(0);break;case"abgr":case"rgba":r=new Uint32Array(e).fill(0)}return r}static MIN_VALUE(){return 0}static fromWindow(t,e=!0){let r=new TRaster(t.metadata.type,t.metadata.width,t.metadata.height);return r.pixelData=!0===e?[...t.raster.pixelData]:t.raster.pixelData,r.setWindow(t),r}static from(t,e=!0){let r=new T.Raster(t.type,t.width,t.height);return r.parent=t.parent,!0===e?r.setPixelData(t.pixelData):r.pixelData=t.pixelData,r}fill(t){this.pixelData.fill(t)}compose(...t){return t.reduceRight((t,e)=>e(t,!1),this)}pipe(...t){return t.reduce((t,e)=>e(t,!1),this)}get(t){return this.pixelData[t]}getPixel(t,e){let r=t+e*this.width;return this.pixelData[r]}xy(t){return[this.x(t),this.y(t)]}x(t){return t%this.width}y(t){return Math.floor(t/this.width)}set(t,e){this.pixelData[t]=e}setDimension(t,e){this.width=t,this.height=e,this.length=t*e}setPixel(t,e,r){this.pixelData[t+e*this.width]=r}setPixelData(t){if(t instanceof{uint8:Uint8ClampedArray,uint16:Uint16Array,float32:Float32Array,rgba:Uint32Array}[this.type])this.pixelData=t;else switch(this.type){case"uint8":this.pixelData=new Uint8ClampedArray(t);break;case"uint16":this.pixelData=new Uint16Array(t);break;case"uint32":this.pixelData=new Uint32Array(t);break;case"float32":this.pixelData=new Float32Array(t);break;case"abgr":case"rgba":this.pixelData=new Uint32Array(t)}}pad(t,e,r){for(let n=0;n<r.height;n++)r.pixelData.slice(n*r.width,(n+1)*r.width).forEach((r,i)=>this.pixelData[t+i+(e+n)*this.width]=r,this)}}},function(t,e,r){"use strict";e.a=class{constructor(t,e,r,n="black"){this.width=e,this.height=r,this.length=this.width*this.height,this.type=t,this.metadata={dimension:2,type:t,width:e,height:r,depth:1,fill:n},this.raster=new T.Raster(t,e,r),this.raster.parent=this,this.fillPattern(n)}fillPattern(t){let e=this.raster;void 0===e.pixelData&&(e.pixelData=T.Raster.createPixels(this.type,this.length),console.log(`Create pixels of ${this.type}`)),"black"===t.toLowerCase()?e.pixelData.fill(T.Raster.MIN_VALUE(this.type)):"white"===t.toLowerCase()?e.pixelData.fill(T.Raster.MAX_VALUE(this.type)):"ramp"===t.toLowerCase()&&e.pixelData.map(t=>T.Raster.MAX_VALUE()/this.width*(i%this.width))}getRaster(){return this.raster}setRaster(t){this.raster=t}setPixels(t){this.raster.pixelData=t}setWindow(t){this.window=t}}},function(t,e,r){"use strict";e.a=class{constructor(t,e,r,n,i="black"){this.width=e,this.height=r,this.type=t,this.pixelData,this.nslices=n,this.length=this.width*this.height*this.nslices,this.metadata={dimension:2.5,title:title,type:t,width:e,height:r,nslices:n,fill:i},this.slices=Array.from({length:n},(n,i)=>new T.Raster(t,e,r,i.toString()))}setPixels(t){this.slices.forEach((e,r)=>e.pixelData=t.slice(r*e.length,r*e.length+e.length))}forEach(t){this.slices.forEach((e,r)=>t(e,!1))}map(t){return this.slices.map((e,r)=>t(e,!0))}slice(t){return this.slices[t]}}},function(t,e,r){"use strict";"use script";e.a=class{constructor(t,e,r,n,i="black"){this.width=e,this.height=r,this.depth=n,this.length=this.width*this.height*this.depth,this.type=t,this.metadata={dimension:3,type:t,width:e,height:r,depth:1,fill:i},this.raster=new T.Raster(t,e,r,n),this.raster.parent=this,this.raster.pixelData=T.Raster.createPixels(this.type,this.length)}}},function(t,e,r){"use strict";e.a=class{constructor(t,e=!0){this.title=t,this.root=document.createElement("article"),this.root.className="twindow",this.root.name=this.title,this.root.id=this.title.toLowerCase(),this.root.style.left=`${1200*Math.random()}px`,this.root.style.top=`${400*Math.random()}px`;let r=document.createElement("header");r.className="theader",r.innerHTML=`<label>${t}</label>`,this.root.appendChild(r);let n=document.createElement("content"),i=document.createElement("footer");i.className="tfooter",this.root.appendChild(r),this.root.appendChild(n),this.root.appendChild(i);let a=[];const o=t=>{r.parentNode.style.top=t.clientY+a[1]+"px",r.parentNode.style.left=t.clientX+a[0]+"px"};r.addEventListener("mousedown",t=>{t.target.parentNode.style.zIndex=99,a=[this.root.offsetLeft-t.clientX,this.root.offsetTop-t.clientY],window.addEventListener("mousemove",o,!0)},!1),window.addEventListener("mouseup",t=>{t.target.parentNode.style.zIndex=1,window.removeEventListener("mousemove",o,!0)},!1),this.element,this.useGPU=!e}addView(t){const e=t=>{let e=document.createElement("canvas");e.layerData=t,this.element=e,this.useGPU||(this.ctx=this.element.getContext("2d")),e.width=t.width,e.height=t.height,this.root.childNodes[1].appendChild(e);let r=document.createElement("p");r.className="tstatus",r.id=this.root.id+"_status",r.appendChild(document.createTextNode("")),this.root.childNodes[2].appendChild(r),e.addEventListener("mousemove",function(t){let e=t.target,r=t.target.parentNode.parentNode.tview,n=e.getBoundingClientRect(),i=Math.floor(t.clientX-n.left),a=Math.floor(t.clientY-n.top),o=e.layerData.raster.pixelData,u=e.layerData.raster.width,s="float32"===r.layers[0].data.raster.type?o[i+a*u]:o[i+a*u]>>>0,c=`(${i},${a}): ${s}`;"rgba"!==r.layers[0].data.raster.type&&"abgr"!==r.layers[0].data.raster.type||(c=`(${i},${a}): rgba(${cpu.red(s)},${cpu.green(s)},${cpu.blue(s)},${cpu.alpha(s)})`),e.parentNode.nextSibling.innerHTML=c})},r=()=>{this.element=document.createElement("table"),this.root.childNodes[1].appendChild(this.element)};this.root.tview=t;for(let n of t.layers)switch(n.type){case"image":e(n.data);break;case"table":r(n.data)}}addToDOM(t){this.root.tview.render(this),document.getElementById(t).appendChild(this.root)}}},function(t,e,r){"use strict";"use script";e.a=class{constructor(t,e,r,n){this.title=t,this.width=r,this.height=n,this.length=this.width*this.height,this.type=e,this.layers=[]}appendLayer(t){this.layers.push(t)}render(t){console.log("render");for(let e of this.layers)switch(e.type){case"3D":render3D(t)(e.data);break;case"graphics":cpu.renderVector(t)(e.data);break;case"image":cpu.render2D(t)(e.data);break;case"table":cpu.renderTable(t)(e.data)}}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),r.d(e,"loadImage",function(){return n});const n=t=>new Promise(e=>{let r=new Image;r.onload=(()=>{let t=r.width,n=r.height,i=new T.Image("rgba",t,n),a=document.createElement("canvas");a.width=r.width,a.height=r.height;let o=a.getContext("2d");o.drawImage(r,0,0,r.width,r.height);let u=new Uint32Array(o.getImageData(0,0,t,n).data.buffer);i.getRaster().pixelData=u,URL.revokeObjectURL(r.src),e({image:i,status:"ok"})}),r.onerror=(()=>e({data:t,status:"error"})),r.src=t,console.log("Load...")})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),r.d(e,"toGray8",function(){return toGray8});var n=r(0),i=r(13),a=r(14),o=r(15),u=r(16),s=r(17),c=r(18),l=r(19),h=r(20),d=r(21),f=r(22),p=r(23),m=r(24),g=r(25),R=r(26);r.d(e,"clamp",function(){return n.a}),r.d(e,"clampUint8",function(){return n.b}),r.d(e,"degrees",function(){return n.c}),r.d(e,"getX",function(){return n.e}),r.d(e,"getY",function(){return n.f}),r.d(e,"getIndex",function(){return n.d}),r.d(e,"pipe",function(){return n.h}),r.d(e,"radians",function(){return n.i}),r.d(e,"red",function(){return i.h}),r.d(e,"blue",function(){return i.b}),r.d(e,"green",function(){return i.e}),r.d(e,"alpha",function(){return i.a}),r.d(e,"luminance",function(){return i.g}),r.d(e,"chrominanceRed",function(){return i.d}),r.d(e,"chrominanceBlue",function(){return i.c}),r.d(e,"hue",function(){return i.f}),r.d(e,"saturation",function(){return i.i}),r.d(e,"value",function(){return i.l}),r.d(e,"splitChannels",function(){return i.j}),r.d(e,"toRGBA",function(){return i.k}),r.d(e,"crop",function(){return a.a}),r.d(e,"canny",function(){return o.a}),r.d(e,"laplacian3x3",function(){return o.b}),r.d(e,"laplacian5x5",function(){return o.c}),r.d(e,"sobel3x3",function(){return o.d}),r.d(e,"KERNEL_RECTANGLE",function(){return u.h}),r.d(e,"KERNEL_CROSS",function(){return u.f}),r.d(e,"KERNEL_DIAMOND",function(){return u.g}),r.d(e,"KERNEL_CIRCLE",function(){return u.e}),r.d(e,"KERNEL_SQUARE",function(){return u.i}),r.d(e,"BORDER_CLAMP_TO_EDGE",function(){return u.b}),r.d(e,"BORDER_CLAMP_TO_BORDER",function(){return u.a}),r.d(e,"BORDER_REPEAT",function(){return u.d}),r.d(e,"BORDER_MIRROR",function(){return u.c}),r.d(e,"houghLines",function(){return s.b}),r.d(e,"houghCircles",function(){return s.a}),r.d(e,"convolve",function(){return u.k}),r.d(e,"convolutionKernel",function(){return u.j}),r.d(e,"mean",function(){return u.l}),r.d(e,"meanKernel",function(){return u.m}),r.d(e,"black",function(){return c.a}),r.d(e,"calc",function(){return c.b}),r.d(e,"chessboard",function(){return c.c}),r.d(e,"fillColor",function(){return c.e}),r.d(e,"fill",function(){return c.d}),r.d(e,"math",function(){return c.f}),r.d(e,"ramp",function(){return c.g}),r.d(e,"spiral",function(){return c.h}),r.d(e,"white",function(){return c.i}),r.d(e,"noise",function(){return l.a}),r.d(e,"saltAndPepper",function(){return l.b}),r.d(e,"medianFilter",function(){return h.b}),r.d(e,"maximumFilter",function(){return h.a}),r.d(e,"minimumFilter",function(){return h.c}),r.d(e,"varianceFilter",function(){return h.d}),r.d(e,"histogram",function(){return d.a}),r.d(e,"statistics",function(){return d.b}),r.d(e,"otsu",function(){return f.a}),r.d(e,"threshold",function(){return f.b}),r.d(e,"fromABGRtoUint8",function(){return p.a}),r.d(e,"toUint8",function(){return p.b}),r.d(e,"montage",function(){return m.a}),r.d(e,"view",function(){return m.b}),r.d(e,"renderUint8",function(){return g.f}),r.d(e,"renderUint16",function(){return g.e}),r.d(e,"renderFloat32",function(){return g.c}),r.d(e,"renderABGR",function(){return g.b}),r.d(e,"renderRGBA",function(){return g.d}),r.d(e,"render2D",function(){return g.a}),r.d(e,"renderVector",function(){return R.a})},function(t,e,r){"use strict";r.d(e,"h",function(){return c}),r.d(e,"e",function(){return s}),r.d(e,"b",function(){return u}),r.d(e,"a",function(){return o}),r.d(e,"g",function(){return l}),r.d(e,"d",function(){return h}),r.d(e,"c",function(){return d}),r.d(e,"f",function(){return f}),r.d(e,"i",function(){return p}),r.d(e,"l",function(){return m}),r.d(e,"k",function(){return a}),r.d(e,"j",function(){return g});var n=r(0);const i=Object(n.a)(0,255),a=(t,e,r,i)=>Object(n.g)()?i<<24|r<<16|e<<8|t:t<<24|e<<16|r<<8|i,o=t=>Object(n.g)()?t>>24&255:255&t,u=t=>Object(n.g)()?t>>16&255:t>>8&255,s=t=>Object(n.g)()?t>>8&255:t>>16&255,c=t=>Object(n.g)()?255&t:t>>24&255,l=t=>{let e=c(t),r=s(t);return e+e+e+u(t)+r+r+r+r>>3},h=t=>-.168736*c(t)-.331264*s(t)+.5*u(t)+128,d=t=>.5*c(t)-.418688*s(t)-.081312*u(t)+128,f=t=>{const e=(t,e,r)=>(t-e)/r;let r=T.red(t)/255,n=T.green(t)/255,a=T.blue(t)/255,o=Math.max(r,Math.max(n,a)),u=Math.min(r,Math.min(n,a)),s=o-u,c=0===o||u===o?0:o===r?(60*e(n,a,s)+0)%360:o===n?60*e(a,r,s)+120:60*e(r,n,s)+240;return i(Math.floor(c/360*255))},p=t=>{let e=T.red(t),r=T.blue(t),n=T.green(t),i=Math.max(e,Math.max(n,r)),a=Math.min(e,Math.min(n,r));return 0===i?0:255*(1-a/i)},m=t=>Math.max(T.red(t),Math.max(T.green(t),T.blue(t))),g=(...t)=>(e,r=!0)=>{let n=new T.Stack("Split Channels","uint8",e.width,e.height,t.length);return n.slices.forEach(t=>t.pixelData=T.Raster.createPixels("uint8",e.length)),n.slices.forEach((r,n)=>{r.label=t[n].name,r.pixelData.forEach((r,i,a)=>a[i]=t[n](e.pixelData[i]))}),n}},function(t,e,r){"use strict";r.d(e,"a",function(){return n});const n=(t,e,r,n)=>(i,a=!0)=>{let o=T.Raster.from(i,!1),u=Array.from({length:n},(r,n)=>t+(e+n)*i.width).reduce((t,e)=>{return[...t,...i.pixelData.slice(e,e+r)]},[]);return o.width=r,o.height=n,o.setPixelData(u),o}},function(t,e,r){"use strict";r.d(e,"a",function(){return u}),r.d(e,"b",function(){return i}),r.d(e,"c",function(){return a}),r.d(e,"d",function(){return o});var n=r(1);const i=(t=cpu.BORDER_CLAMP_TO_BORDER)=>(e,r=!0)=>{let i=t===cpu.BORDER_CLAMP_TO_EDGE?n.c:t===cpu.BORDER_REPEAT?n.e:t===cpu.BORDER_MIRROR?mirror:n.b,a=T.Raster.from(e,!1);return a.pixelData=n.a(e.pixelData,e.width,e.height,null,i,(t,e,r,n,i,a)=>{let o=cpu.getX(t,r),u=cpu.getY(t,r);return-a(e,o-1,u-1,r,n)-a(e,o,u-1,r,n)-a(e,o+1,u-1,r,n)-a(e,o-1,u,r,n)+8*a(e,o,u,r,n)-a(e,o+1,u,r,n)-a(e,o-1,u+1,r,n)-a(e,o,u+1,r,n)-a(e,o+1,u+1,r,n)}),a},a=(t=cpu.BORDER_CLAMP_TO_BORDER)=>(e,r=!0)=>{let i=t===cpu.BORDER_CLAMP_TO_EDGE?n.c:t===cpu.BORDER_REPEAT?n.e:t===cpu.BORDER_MIRROR?mirror:n.b,a=T.Raster.from(e,!1),o=cpu.convolutionKernel(cpu.KERNEL_SQUARE,5,5,[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,16,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0],!1);return a.pixelData=n.a(e.pixelData,e.width,e.height,o,i,n.d),a},o=(t=cpu.BORDER_CLAMP_TO_EDGE)=>(e,r=!0)=>{let i=t===cpu.BORDER_CLAMP_TO_EDGE?n.c:t===cpu.BORDER_REPEAT?n.e:t===cpu.BORDER_MIRROR?mirror:n.b,a=T.Raster.from(e,!1),o=n.a(new Float32Array(e.pixelData),e.width,e.height,null,i,(t,e,r,n,i,a)=>{let o=cpu.getX(t,r),u=cpu.getY(t,r),s=a(e,o-1,u-1,r,n),c=a(e,o,u-1,r,n),l=a(e,o+1,u-1,r,n),h=a(e,o-1,u,r,n),d=a(e,o+1,u,r,n),f=a(e,o-1,u+1,r,n),p=a(e,o,u+1,r,n),m=a(e,o+1,u+1,r,n),g=s-l+2*h-2*d+f-m,R=s+2*c+l-f-2*p-m;return Math.sqrt(g*g+R*R)});return a.pixelData="uint8"===a.type?new Uint8ClampedArray(o):"uint16"===a.type?new Uint16Array(o):o,console.log("SOBEL"),console.log(a),a},u=(t,e=3*t,r=5,i=1,a=cpu.BORDER_CLAMP_TO_BORDER)=>(r,i=!0)=>{let o=T.Raster.from(r,!1);o.type="uint8",o.pixelData=new Uint8ClampedArray(r.length);let u=a===cpu.BORDER_CLAMP_TO_EDGE?n.c:a===cpu.BORDER_REPEAT?n.e:a===cpu.BORDER_MIRROR?mirror:n.b;"uint16"===r.type&&(t*=256,e*=256),"float32"===r.type&&(t=t/128-1,e=e/128-1),console.log("Canny...");let s=((t,e,r,n)=>t.reduce((t,i,a,o)=>(t[a]=((t,e,r,n,i)=>{let a=cpu.getX(t,r),o=cpu.getY(t,r),u=i(e,a-1,o-1,r,n),s=i(e,a,o-1,r,n),c=i(e,a+1,o-1,r,n),l=i(e,a-1,o,r,n),h=i(e,a+1,o,r,n),d=i(e,a-1,o+1,r,n),f=i(e,a,o+1,r,n),p=i(e,a+1,o+1,r,n),m=u-c+2*l-2*h+d-p,g=u+2*s+c-d-2*f-p,R=Math.hypot(m,g),E=Math.atan2(g,m);return{mag:R,thetaQ:(Math.round(E*(5/Math.PI))+5)%5%4}})(a,o,e,r,n),t),new Array(e*r)))(r.pixelData,r.width,r.height,u);const c=((t,e,r,n,i,a)=>{const o=(t,e,r,n)=>t[e+r*n];let u="float32"==r?-1:0;return r.reduce((r,n,s,c)=>{let l=s%t,h=Math.floor(s/t),d=0===l||l===t-1||0===h||h===e-1?u:0===n.thetaQ&&(n.mag<=o(c,l-1,h,t).mag||n.mag<=o(c,l+1,h,t).mag)||1===n.thetaQ&&(n.mag<=o(c,l+1,h-1,t).mag||n.mag<=o(c,l-1,h+1,t).mag)||2===n.thetaQ&&(n.mag<=o(c,l,h-1,t).mag||n.mag<=o(c,l,h+1,t).mag)||3===n.thetaQ&&(n.mag<=o(c,l-1,h-1,t).mag||n.mag<=o(c,l+1,h+1,t).mag)?u:n.mag,f=d>a?{value:255,edge:2}:d>i?{value:0,edge:1}:{value:0,edge:0};return r[s]=f,r},new Array(t*e))})(r.width,r.height,s,r.type,t,e);return o.pixelData=((t,e)=>e.reduce((t,e,r)=>(t.push(e.value),t),[]))(r.width,c),console.log(o.pixelData),o}},function(t,e,r){"use strict";r.d(e,"h",function(){return i}),r.d(e,"f",function(){return a}),r.d(e,"g",function(){return o}),r.d(e,"e",function(){return u}),r.d(e,"i",function(){return s}),r.d(e,"b",function(){return c}),r.d(e,"a",function(){return l}),r.d(e,"d",function(){return h}),r.d(e,"c",function(){return d}),r.d(e,"k",function(){return g}),r.d(e,"j",function(){return p}),r.d(e,"l",function(){return R}),r.d(e,"m",function(){return m});var n=r(1);const i=0,a=1,o=2,u=4,s=8,c=0,l=1,h=2,d=4,f=(t,e,r,n,a=1,o=1)=>{const c=(t,e,r)=>(cpu.getX(t,e)-Math.floor(e/2))*a,l=(t,e,r)=>(cpu.getY(t,e)-Math.floor(r/2))*o;let h;if(t===i||t===s)h=Array.from({length:e*r},(t,i)=>({offsetX:c(i,e),offsetY:l(i,e,r),weight:n[i]}));else if(t===u){let t=r;h=Array.from({length:e*e}).reduce((r,i,a)=>{let o=c(a,e),u=l(a,e,e);return o*o+u*u<=t*t&&r.push({offsetX:o,offsetY:u,weight:n[a]}),r},[])}return h},p=(t,e,r,n,i=!0)=>{let a=f(t,e,r,n),o=a.reduce((t,e)=>t+e.weight,0);return i?a.map(t=>(t.weight/=o,t)):a},m=(t,e,r,n=!0)=>{let i=f(hardware,t,e,r,weights),a=i.reduce((t,e)=>t+e,0);return n?i.map(t=>t.weight/=a):i},g=(t,e=cpu.BORDER_CLAMP_TO_BORDER)=>(r,i=!0)=>{let a=e===cpu.BORDER_CLAMP_TO_EDGE?n.c:e===cpu.BORDER_REPEAT?n.e:e===cpu.BORDER_MIRROR?mirror:n.b;console.log(a.name);let o=T.Raster.from(r,!1);return o.pixelData=n.a(r.pixelData,r.width,r.height,t,a,(t,e,r,n,i,a)=>i.reduce((i,o)=>i+=a(e,cpu.getX(t,r)+o.offsetX,cpu.getY(t,r)+o.offsetY,r,n)*o.weight,0)),o},R=t=>(e,r=!0)=>g(t)(e,r)},function(t,e,r){"use strict";r.d(e,"b",function(){return n}),r.d(e,"a",function(){return houghCircles});const n=(t,e,r=!1)=>(r,n=!0)=>{let i=T.Raster.from(r,!1),a=r.width,o=r.height,u=2*Math.trunc(e/2),s=u/2,c=Math.ceil(Math.hypot(a,o)),l=u/2;console.log(`${t} x ${u} = ${t*u} ${c}`),i.width=t,i.height=u,i.type="float32";let h=Array.from({length:t},(e,r)=>{let n=r*Math.PI/t;return{theta:n,cos:Math.cos(n),sin:Math.sin(n)}});return i.pixelData=r.pixelData.reduce((e,r,n)=>{let i=n%a,o=Math.floor(n/a);return 0===r&&h.forEach((r,n)=>{let a=r.cos*i+r.sin*o,u=s+Math.trunc(Math.round(a*l/c));e[n+u*t]+=1}),e},new Float32Array(t*u).fill(0)),i}},function(t,e,r){"use strict";r.d(e,"a",function(){return u}),r.d(e,"b",function(){return h}),r.d(e,"c",function(){return i}),r.d(e,"d",function(){return c}),r.d(e,"e",function(){return n}),r.d(e,"f",function(){return l}),r.d(e,"g",function(){return a}),r.d(e,"h",function(){return o}),r.d(e,"i",function(){return s});const n=t=>(e,r=!0)=>(e.pixelData.fill(t),e),i=(t,e,r,n)=>(Math.floor(r/16)+Math.floor(n/16))%2==0?255:0,a=(t,e,r,n,i,a,o)=>r/a*255,o=(t,e,r,n,i,a,o,u,s)=>128*(Math.sin(s/10+cpu.radians(u))+1),u=t=>0,s=t=>255,c=t=>(e,r=!0)=>{let n=e.width,i=e.height,a=e.depth||e.nslices||0,o=n/2,u=i/2,s=a/2;return e.pixelData.forEach((e,r,a)=>{let c=r%n,l=Math.floor(r/n),h=Math.floor(r/n/i),d=Math.sqrt((c-o)**2+(l-u)**2+(h-s)**2),f=Math.atan2(l,c);a[r]=t(e,r,c,l,h,n,i,f,d)}),e},l=t=>(e,r=!0)=>cpu.fill(t)(T.Raster.from(e,r),r),h=(t,e)=>(r,n=!0)=>{let i=T.Raster.from(r,n);return i.pixelData.forEach((n,a,o)=>{let u=r.width,s=a%u,c=Math.floor(a/u),l=t.pixelData[a];i.pixelData[a]=e(l,n,a,s,c)}),i}},function(t,e,r){"use strict";r.d(e,"a",function(){return i}),r.d(e,"b",function(){return n});const n=(t=.05)=>(e,r=!0)=>{let n=T.Raster.from(e,r),i=n.pixelData;return Array.from({length:Math.floor(e.length*t)},t=>Math.floor(Math.random()*e.length)).forEach((t,e)=>i[t]=e%2==0?255:0),n},i=(t=25)=>(e,r=!0)=>{const n=(t,e,r)=>t>=e&&t<=r,i=t=>{let e=0,r=0;for(;0===e;)e=Math.random();for(;0===r;)r=Math.random();return Math.sqrt(-2*Math.log(e)*t)*Math.cos(2*Math.PI*r)};T.statistics(e);let a=T.Raster.from(e,r),o=a.pixelData,u=t**2;return e.pixelData.forEach((t,e)=>{do{o[e]=Math.floor(t+i(u))}while(!n(o[e],0,255))}),a}},function(t,e,r){"use strict";r.d(e,"b",function(){return s}),r.d(e,"a",function(){return u}),r.d(e,"c",function(){return o}),r.d(e,"d",function(){return i});var n=r(1);const i=(t,e=cpu.BORDER_CLAMP_TO_BORDER)=>(r,i=!0)=>{let a=e===cpu.BORDER_CLAMP_TO_EDGE?n.c:e===cpu.BORDER_REPEAT?n.e:e===cpu.BORDER_MIRROR?mirror:n.b,o=T.Raster.from(r,!1);return o.pixelData=n.a(r.pixelData,r.width,r.height,t,a,(t,e,r,n,i,a)=>{let[o,u]=i.reduce((i,o)=>{let u=a(e,cpu.getX(t,r)+o.offsetX,cpu.getY(t,r)+o.offsetY,r,n);return i[0]+=u,i[1]+=u*u,i},[0,0]);return(u-o*o/i.length)/(i.length-1)}),cpu.statistics(o),console.log(o.statistics),o},a=(t,e,r,i,a)=>{let o=e===cpu.BORDER_CLAMP_TO_EDGE?n.c:e===cpu.BORDER_REPEAT?n.e:e===cpu.BORDER_MIRROR?mirror:n.b,u=T.Raster.from(r,!1);return u.pixelData=n.a(r.pixelData,r.width,r.height,t,o,(t,e,r,n,i,o)=>{let u=i.reduce((i,a)=>{let u=o(e,cpu.getX(t,r)+a.offsetX,cpu.getY(t,r)+a.offsetY,r,n);return i.push(u),i},[]);return a(...u)}),cpu.statistics(u),console.log(u.statistics),u},o=(t,e=cpu.BORDER_CLAMP_TO_BORDER)=>(r,n=!0)=>a(t,e,r,0,Math.min),u=(t,e=cpu.BORDER_CLAMP_TO_BORDER)=>(r,n=!0)=>a(t,e,r,0,Math.max),s=(t,e=cpu.BORDER_CLAMP_TO_BORDER)=>(r,n=!0)=>{return a(t,e,r,0,(...t)=>{t.sort((t,e)=>t-e);let e=Math.floor(t.length/2);return t.length%2?t[e]:(t[e-1]+t[e])/2})}},function(t,e,r){"use strict";r.d(e,"a",function(){return i}),r.d(e,"b",function(){return n});const n=(t,e=!0)=>{let r=t.pixelData.reduce((t,e,r)=>{t.min=Math.min(t.min,e),t.max=Math.max(t.max,e),t.mean+=e,t.n++;let n=e-t.mean2;return t.mean2+=n/t.n,t.variance+=n*n,t},{min:Number.MAX_SAFE_INTEGER,max:0,mean:0,mean2:0,n:0,variance:0});return t.statistics={min:r.min,max:r.max,count:t.pixelData.length,mean:r.mean/t.pixelData.length,stddev:Math.sqrt(r.variance/t.pixelData.length)},t},i=t=>(e,r=!0)=>{n(e);let i=e.statistics.max-e.statistics.min;return e.statistics.binSize=t/i,e.statistics.histogram=e.pixelData.reduce((t,e,r)=>{return t[e]++,t},new Array(t).fill(0)),e}},function(t,e,r){"use strict";r.d(e,"a",function(){return i}),r.d(e,"b",function(){return n});const n=t=>(e,r=!0)=>{let n=T.Raster.from(e,r);return e.pixelData.forEach((e,r)=>n.pixelData[r]=e>t?0:255),cpu.histogram(256)(n,r),n},i=function(t,e=!0){let r="uint8"===t.type||"float32"===t.type?256:65536,i=(t=>{let[e,r]=t.reduce((t,e,r,n)=>(t[0]+=r*e,t[1]+=e,t),[0,0]);return t.reduce((t,n,i,a)=>{t.Sk+=i*a[i],t.N1+=a[i];let o=t.N1*(r-t.N1);if(0!==o){let n=t.N1/r*e-t.Sk;t.BCV=n*n/o}else t.BCV=0;return t.BCV>=t.BCVmax&&(t.BCVmax=t.BCV,t.kStar=i),t},{BCV:0,BCVmax:0,kStar:0,Sk:0,N1:0}).kStar})((t=cpu.histogram(r)(t)).statistics.histogram);return console.log(`Otsu Threshold: ${i}`),n(i)(t,e)}},function(t,e,r){"use strict";r.d(e,"a",function(){return n}),r.d(e,"b",function(){return i});const n=t=>(e,r=!0)=>{let n=T.Raster.from(e,!1);return n.pixelData=new Uint8ClampedArray(e.length),n.type="uint8",e.pixelData.forEach((e,r)=>n.pixelData[r]=t(e)),n},i=t=>(e,r=!0)=>{if("uint8"===e.type)return e;{let r=T.Raster.from(e,!1);if(r.type="uint8","uint16"===e.type)r.pixelData=e.pixelData.reduce((t,e,r)=>(t[r]=e+1+(e>>8)>>8,t),new Uint8ClampedArray(r.width*r.height));else if("float32"===e.type){cpu.statistics(e);let t=e.statistics.min,n=255/(e.statistics.max-t);r.pixelData=e.pixelData.reduce((e,r,i)=>(e[i]=(r-t)*n,e),new Uint8ClampedArray(r.width*r.height))}else"rgba"===e.type&&(r.pixelData=e.pixelData.map(e=>t(e)));return r}}},function(t,e,r){"use strict";r.d(e,"a",function(){return i}),r.d(e,"b",function(){return n});const n=(t,e=!0)=>{t.parent.setRaster(t),t.parent.width=t.width,t.parent.height=t.height,t.parent.type=t.type;let r=new T.View("view",t.type,t.width,t.height);return r.appendLayer({type:"image",data:t.parent}),r},i=(t,e,r=1,n=0)=>(r,n=!0)=>{let i=new T.View("montage",r.type,r.width*e,r.height*t),a=new T.Image(r.type,r.width*e,r.height*t);r.slices.forEach((t,n)=>a.raster.pad(n%e*r.width,Math.floor(n/e)*r.height,t)),i.appendLayer({type:"image",data:a});return i.appendLayer({type:"graphics",data:[{type:"text",x:0,y:0,content:"Test"}]}),i}},function(t,e,r){"use strict";r.d(e,"f",function(){return n}),r.d(e,"e",function(){return i}),r.d(e,"c",function(){return a}),r.d(e,"b",function(){return renderABGR}),r.d(e,"d",function(){return o}),r.d(e,"a",function(){return u});r(0);const n=t=>(e,r=!0)=>{let n=t.ctx.createImageData(e.width,e.height),i=new ArrayBuffer(e.width*e.height*4),a=new Uint32Array(i),o=new Uint8Array(i);a.forEach((t,r,n)=>n[r]=cpu.toRGBA(e.pixelData[r],e.pixelData[r],e.pixelData[r],255)),n.data.set(o),t.ctx.putImageData(n,0,0)},i=t=>(e,r=!0)=>{console.log("renderUint16");let n=t.ctx.createImageData(e.width,e.height),i=new ArrayBuffer(e.width*e.height*4),a=new Uint32Array(i),o=new Uint8Array(i);a.forEach((t,r,n)=>n[r]=cpu.toRGBA(e.pixelData[r]>>8,e.pixelData[r]>>8,e.pixelData[r]>>8,255)),n.data.set(o),t.ctx.putImageData(n,0,0)},a=t=>(e,r=!0)=>{let n=t.ctx.createImageData(e.width,e.height),i=(cpu.statistics(e),new ArrayBuffer(e.width*e.height*4)),a=new Uint32Array(i),o=new Uint8Array(i),u=255/(e.statistics.max-e.statistics.min);a.forEach((t,r,n)=>{let i=Math.floor((e.pixelData[r]-e.statistics.min)*u);n[r]=cpu.toRGBA(i,i,i,255)}),n.data.set(o),t.ctx.putImageData(n,0,0)},o=t=>(e,r=!0)=>{let n=t.ctx.createImageData(e.width,e.height),i=new Uint8Array(e.pixelData.buffer);n.data.set(i),t.ctx.putImageData(n,0,0)},u=t=>(e,r=!0)=>{switch(console.log(t),e.raster.type){case"uint8":n(t)(e.raster);break;case"uint16":i(t)(e.raster);break;case"float32":a(t)(e.raster);break;case"rgba":case"abgr":o(t)(e.raster)}}},function(t,e,r){"use strict";r.d(e,"a",function(){return n});const n=t=>(t,e=!0)=>{console.log("renderVector")}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),r.d(e,"viewport",function(){return viewport});var n=r(28),i=r(29),a=r(30),o=r(31),u=r(32),s=r(33),c=r(34);r.d(e,"POINTS",function(){return n.z}),r.d(e,"LINES",function(){return n.k}),r.d(e,"LINE_LOOP",function(){return n.l}),r.d(e,"LINE_STRIP",function(){return n.m}),r.d(e,"TRIANGLES",function(){return n.E}),r.d(e,"TRIANGLE_STRIP",function(){return n.G}),r.d(e,"TRIANGLE_FAN",function(){return n.F}),r.d(e,"NEAREST",function(){return n.r}),r.d(e,"LINEAR",function(){return n.j}),r.d(e,"REPEAT",function(){return n.A}),r.d(e,"CLAMP_TO_EDGE",function(){return n.b}),r.d(e,"MIRRORED_REPEAT",function(){return n.q}),r.d(e,"CLAMP",function(){return n.a}),r.d(e,"MIRROR",function(){return n.p}),r.d(e,"FUNC_ADD",function(){return n.g}),r.d(e,"FUNC_SUBSTRACT",function(){return n.i}),r.d(e,"FUNC_REVERSE_SUBTRACT",function(){return n.h}),r.d(e,"MIN",function(){return n.o}),r.d(e,"MAX",function(){return n.n}),r.d(e,"ZERO",function(){return n.H}),r.d(e,"ONE",function(){return n.s}),r.d(e,"SRC_COLOR",function(){return n.D}),r.d(e,"ONE_MINUS_SRC_COLOR",function(){return n.y}),r.d(e,"SRC_ALPHA",function(){return n.B}),r.d(e,"ONE_MINUS_SRC_ALPHA",function(){return n.x}),r.d(e,"DST_ALPHA",function(){return n.e}),r.d(e,"ONE_MINUS_DST_ALPHA",function(){return n.v}),r.d(e,"DST_COLOR",function(){return n.f}),r.d(e,"ONE_MINUS_DST_COLOR",function(){return n.w}),r.d(e,"SRC_ALPHA_SATURATE",function(){return n.C}),r.d(e,"CONSTANT_COLOR",function(){return n.d}),r.d(e,"ONE_MINUS_CONSTANT_COLOR",function(){return n.u}),r.d(e,"CONSTANT_ALPHA",function(){return n.c}),r.d(e,"ONE_MINUS_CONSTANT_ALPHA",function(){return n.t}),r.d(e,"createGPU",function(){return i.a}),r.d(e,"createProgram",function(){return i.b}),r.d(e,"getGraphicsContext",function(){return i.c}),r.d(e,"rectangle",function(){return i.d}),r.d(e,"Processor",function(){return a.a}),r.d(e,"invert",function(){return o.a}),r.d(e,"fill",function(){return u.a}),r.d(e,"blend",function(){return s.a}),r.d(e,"histogram",function(){return c.a})},function(t,e,r){"use strict";e.z=0;e.k=1;e.l=2;e.m=3;e.E=4;e.G=5;e.F=6;e.r=9728;e.j=9729;e.A=10497;e.b=33071;e.q=33648;e.a=33071;e.p=33648;e.g=32774;e.i=32778;e.h=32779;e.o=32775;e.n=32776;e.H=0;e.s=1;e.D=768;e.y=769;e.B=770;e.x=771;e.e=772;e.v=773;e.f=774;e.w=775;e.C=776;e.d=32769;e.u=32770;e.c=32771;e.t=32772},function(t,e,r){"use strict";r.d(e,"a",function(){return n}),r.d(e,"c",function(){return i}),r.d(e,"b",function(){return a}),r.d(e,"d",function(){return o});const n=(t,e=-1,r=-1)=>new gpu.Processor(t.context,t.canvas,e,r),i=(t="preview")=>{let e,r=document.getElementById(t),n={};try{(e=r.getContext("webgl2")).getExtension("EXT_color_buffer_float")||alert("need EXT_color_buffer_float"),n.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),n.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}catch(t){}return e||alert("Could not initialise WebGL2, sorry :-("),{canvas:r,context:e,parameters:n}},a=(t,e,r)=>{const n=(t,e,r)=>{let n,i=e;if("fragment"==r)n=t.createShader(t.FRAGMENT_SHADER);else{if("vertex"!=r)return null;n=t.createShader(t.VERTEX_SHADER)}return t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(alert(` ${r}: ${t.getShaderInfoLog(n)}`),null)};let i,a={program:null,attributes:{},uniforms:{}},o=t.context,u=/in\s*(\w+)\s(\w+)/gm;for(;null!==(i=u.exec(e));)a.attributes[i[2]]={type:i[1],name:i[2],location:null};for(u=/uniform\s*(\w+)\s+(\w+)\s*(\[)*/gm;null!==(i=u.exec(e));)a.uniforms[i[2]]={type:i[1]+(i[3]?"[]":""),name:i[2],location:null};for(;null!==(i=u.exec(r));)a.uniforms[i[2]]={type:i[1]+(i[3]?"[]":""),name:i[2],location:null};return console.log(a),a.program=o.createProgram(),o.attachShader(a.program,n(o,e,"vertex")),o.attachShader(a.program,n(o,r,"fragment")),o.linkProgram(a.program),o.getProgramParameter(a.program,o.LINK_STATUS)||alert("Could not initialise shaders"),Object.values(a.attributes).forEach(t=>t.location=o.getAttribLocation(a.program,t.name)),Object.values(a.uniforms).forEach(t=>t.location=o.getUniformLocation(a.program,t.name)),a},o=(t,e)=>({type:gpu.TRIANGLE_STRIP,num:4,vertices:new Float32Array([0,0,0,0,0,e,0,1,t,0,1,0,t,e,1,1])})},function(t,e,r){"use strict";e.a=class{constructor(t,e,r=-1,n=-1){this.context=t,this.canvas=e,this.canvas.width=r,this.canvas.height=n,this.width=r,this.height=n,this.geometries={},this.textures=[],this.attributes={},this.uniforms={},this.framebuffers={}}attribute(t,e,r,n,i){return this.attributes[t]={name:t,num:e,type:r,stride:n,offset:i,location:null},this}clearCanvas(t=[.1,.1,.1,1]){let e=this.context;return e.clearColor(t[0],t[1],t[2],t[3]),e.clear(e.COLOR_BUFFER_BIT),this}geometry(t){let e=this.context;return this.geometries.type=t.type,this.geometries.glType=t.type,this.geometries.buffer=e.createBuffer(),this.geometries.numVertices=t.num,e.bindBuffer(e.ARRAY_BUFFER,this.geometries.buffer),e.bufferData(e.ARRAY_BUFFER,t.vertices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this}packWith(t){let e=this.context;return this.shader=t,Object.values(this.attributes).forEach(e=>{e.location=t.attributes[e.name].location,e.component=t.attributes[e.name].type}),console.log(this.attributes),this.vao=e.createVertexArray(),e.bindVertexArray(this.vao),e.bindBuffer(e.ARRAY_BUFFER,this.geometries.buffer),Object.values(this.attributes).forEach(t=>{console.log(t),e.enableVertexAttribArray(this.attributes[t.name].location),e.vertexAttribPointer(this.attributes[t.name].location,this.attributes[t.name].num,e.FLOAT,!1,this.attributes[t.name].stride,this.attributes[t.name].offset)}),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindVertexArray(null),this}redirectTo(t,e="uint8",r=0){let n=this.context;if(void 0===this.framebuffers[t]){console.log("CREATE FBO");let i=n.createFramebuffer(),[a,o,u]="uint16"==e||"float32"===e?[n.RGBA32F,n.FLOAT,new Float32Array(this.width*this.height*4)]:[n.RGBA,n.UNSIGNED_BYTE,new Uint8ClampedArray(this.width*this.height*4)],s=this._createTexture(n,u,this.width,this.height,a,n.RGBA,o,n.CLAMP_TO_EDGE,n.NEAREST,n.NEAREST);n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+r,n.TEXTURE_2D,s,0),this.framebuffers[t]={id:"framebuffer",name:t,buffer:i,texture:s,format:a,srcType:o}}else n.bindFramebuffer(n.FRAMEBUFFER,this.framebuffers[t].buffer);return n.bindTexture(n.TEXTURE_2D,this.framebuffers[t].texture),this}size(t,e){return this.canvas.width=t,this.canvas.height=e,this.width=t,this.height=e,this}_createTexture(t,e,r,n,i,a,o,u,s,c){let l=t;const h=l.createBuffer();l.bindBuffer(l.PIXEL_UNPACK_BUFFER,h),l.bufferData(l.PIXEL_UNPACK_BUFFER,e,l.STATIC_DRAW);let d=l.createTexture();l.bindTexture(l.TEXTURE_2D,d),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,u),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,u),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,s),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,c);let f=i,p=a,m=o;return l.texImage2D(l.TEXTURE_2D,0,f,r,n,0,p,m,0),l.bindTexture(l.TEXTURE_2D,null),d}textures(t){return t.forEach(t=>this.texture(t.raster,t.unit,t.wrap,t.mini,t.mag)),this}texture(t,e=0,r=gpu.CLAMP,n=gpu.NEAREST,i=gpu.NEAREST){if(void 0!==t.id&&"framebuffer"===t.id)return console.log("This is a FBO..."),this.textures[0]={texture:t.texture,unit:e},this;let a=this.context;const o={clamp:a.CLAMP_TO_EDGE,repeat:a.REPEAT,mirror:a.MIRRORED_REPEAT,nearest:a.NEAREST,uint8:a.UNSIGNED_BYTE,uint16:a.UNSIGNED_SHORT,float32:a.FLOAT,rgba:a.UNSIGNED_BYTE,gray:a.LUMINANCE,color:a.RGBA};this.width=t.width,this.height=t.height,console.log(t.type,a.R16UI,a.RED_INTEGER);let u=this._createTexture(a,t.pixelData,t.width,t.height,"uint8"===t.type?a.LUMINANCE:"uint16"===t.type?a.R16UI:"float32"===t.type?a.R32F:a.RGBA,"uint8"===t.type?a.LUMINANCE:"uint16"===t.type?a.RED_INTEGER:"float32"===t.type?a.RED:a.RGBA,o[t.type],r,n,i);return this.textures.push({texture:u,unit:e}),this}preprocess(t=[]){let e=this.context;return void 0===t.find(t=>"viewport"===t.name)&&t.push({name:"viewport",params:[0,0,this.width,this.height]}),t.forEach(t=>{switch(t.name){case"blend":e.blendEquation(t.params[0]),e.blendFunc(t.params[1],t.params[2]),e.enable(e.BLEND);break;case"viewport":e.viewport(t.params[0],t.params[1],t.params[2],t.params[3])}}),e.useProgram(this.shader.program),this}postprocess(){return this}readPixels(t){let e=this.context,r=this.framebuffers[t];e.bindFramebuffer(e.FRAMEBUFFER,r.buffer),e.bindTexture(e.TEXTURE_2D,r.texture);let n=new Float32Array(this.width*this.height*4);return e.readPixels(0,0,this.width,this.height,e.RGBA,r.srcType,n),n}run(){let t=this.context;return t.bindVertexArray(this.vao),this.textures.forEach(e=>{t.activeTexture(t.TEXTURE0+e.unit),t.bindTexture(t.TEXTURE_2D,e.texture)}),t.drawArrays(this.geometries.glType,0,this.geometries.numVertices),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),this}uniform(t,e){let r=this.context,n=this.shader.uniforms[t];switch(n.type){case"float":r.uniform1f(n.location,e);break;case"int":r.uniform1i(n.location,e);break;case"uint":r.uniform1ui(n.location,e);break;case"int[]":r.uniform1iv(n.location,e);break;case"float[]":r.uniform1fv(n.location,e);break;case"mat2":r.uniformMatrix2fv(n.location,e);break;case"mat3":r.uniformMatrix3fv(n.location,e);break;case"mat4":r.uniformMatrix4fv(n.location,e);break;case"sampler2D":r.uniform1i(n.location,e);break;case"vec2":r.uniform2fv(n.location,e);break;case"vec3":r.uniform3fv(n.location,e);break;case"vec4":r.uniform4fv(n.location,e)}return this}}},function(t,e,r){"use strict";r.d(e,"a",function(){return n});const n=(t,e,r=!0)=>{let n,i="uint16"===t.type?"usampler2D":"sampler2D";switch(t.type){case"uint8":case"rgba":n="1.0 -texture(u_image, v_texCoord).rgb";break;case"uint16":n="vec3(1.0 - float(texture(u_image, v_texCoord).r) / maxUint16 )";break;case"float32":n="vec3(1.0 - texture(u_image, v_texCoord).r)"}let a=gpu.createProgram(e,"#version 300 es\n\n  in vec2 a_vertex;\n  in vec2 a_texCoord;\n  \n  uniform vec2 u_resolution;\n  \n  out vec2 v_texCoord;\n  \n  void main() {\n    v_texCoord = a_texCoord;\n    vec2 clipSpace = a_vertex * u_resolution * 2.0 - 1.0;\n    gl_Position = vec4( clipSpace * vec2(1,-1), 0.0, 1.0);\n  }",((t,e)=>`#version 300 es\n    #pragma debug(on)\n\n    precision mediump usampler2D;\n    precision mediump float;\n    \n    in vec2 v_texCoord;\n    const float maxUint16 = 65535.0;\n    uniform ${t} u_image;\n    out vec4 outColor;\n    \n    void main() {\n      outColor = vec4(${e}, 1.0); \n    }`)(i,n));console.log("programs done...");gpu.createGPU(e).size(t.width,t.height).geometry(gpu.rectangle(t.width,t.height)).attribute("a_vertex",2,"float",16,0).attribute("a_texCoord",2,"float",16,8).texture(t,0).packWith(a).clearCanvas([0,1,1,1]).preprocess().uniform("u_resolution",new Float32Array([1/t.width,1/t.height])).uniform("u_image",0).run();return t}},function(t,e,r){"use strict";r.d(e,"a",function(){return n});const n=t=>(e,r=!0)=>{let n=function(t){let e=/\(([^)]+)\)/g.exec(t)[1].split(",");if(9!==e.length){const t=["pix","index","x","y","z","rasterWidth","rasterHeight","angle","distance"];e=[...e,...t.slice(e.length,t.length)]}let r="";r=(r=void 0===/\{(.*)\}/g.exec(t)?/\{(.*)\}/g.exec(t)[1]:/=>(.*)$/g.exec(t)[1]).replace(/Math\./g,"").replace(/cpu\./g,"").replace(/([\d.]+)/g,"$1.0").replace(/(\.\d+).0/g,"$1");let n=`#version 300 es\n      precision highp float;\n      \n      // we need to declare an output for the fragment shader\n      out vec4 outColor;\n      uniform vec2 u_rasterSize;\n\n      ${`vec4 fill(float ${e[0]}) {\n        float ${e[2]} = gl_FragCoord.x; \n        float ${e[3]} = gl_FragCoord.y;\n        // float ${e[4]} = gl_FragCoord.z;\n        float ${e[5]} = u_rasterSize.x;\n        float ${e[6]} = u_rasterSize.y;\n        int ${e[1]} = int(${e[2]} + ${e[5]} * ${e[3]});\n        float halfw = ${e[5]} / 2.0;\n        float halfh = ${e[6]} / 2.0;\n        vec2 point = vec2((${e[2]} - halfw), (${e[3]} - halfh));\n        float ${e[8]} = sqrt( dot(point,point) );\n        float ${e[7]} = atan(${e[3]}/${e[2]});\n        float value = ${r};\n        return vec4(vec3(value / 255.0),1.0);\n      }`}\n      \n      void main() {\n        outColor = vec4(fill(0.0)); \n      }`;return console.log(n),n}(t.toString()),i=gpu.createProgram(gpuEnv,"#version 300 es\n\n  in vec2 a_vertex;\n  \n  void main() {\n    gl_Position = vec4(a_vertex * 2.0 - 1.0, 0.0, 1.0);\n  }",n);gpu.createGPU(gpuEnv,e.width,e.height).geometry({type:gpu.TRIANGLE_STRIP,num:4,vertices:new Float32Array([0,0,0,1,1,0,1,1])}).attribute("a_vertex",2,"float",8,0).packWith(i).clearCanvas([0,1,1,1]).preprocess().uniform("u_rasterSize",new Float32Array([e.width,e.height])).run();return e}},function(t,e,r){"use strict";r.d(e,"a",function(){return n});const n=t=>{return t.toString(),{name:"blend",params:[gpu.FUNC_ADD,gpu.ONE,gpu.ONE]}}},function(t,e,r){"use strict";r.d(e,"a",function(){return n});const n=t=>(e,r=!0)=>{let n=gpu.createProgram(gpuEnv,"#version 300 es\n  \n    in float a_pixel;\n\n    uniform float u_maxbin;\n    \n    out float bin;\n    \n    void main() {\n      bin = (a_pixel + 0.5) / u_maxbin;\n      gl_Position = vec4(bin * 2.0 - 1.0, 0.0, 0.0, 1.0);\n    }\n  ","#version 300 es\n    precision mediump float;\n    \n    const vec3 step = vec3(1.0,0.0,0.0);\n    \n    in float bin;\n    out vec4 outColor;\n    \n    void main(){\n      outColor = vec4(step, 1.0) ;\n    }"),i=t,a=gpu.createGPU(gpuEnv,i,1).geometry({type:gpu.POINTS,num:e.width*e.height,vertices:new Float32Array(e.pixelData)}).attribute("a_pixel",1,"float",4,0).packWith(n).clearCanvas([0,0,0,1]).redirectTo("fbo","float32").preprocess([gpu.blend((t,e)=>t+e)]).uniform("u_maxbin",i).run().readPixels("fbo").filter((t,e)=>e%4==0);return void 0===e.statistics?e.statistics={min:-1,max:-1,count:e.pixelData.length,mean:-1,stddev:-1,histogram:a}:e.statistics.histogram=a,e}}])});